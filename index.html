<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Evento Cósmico en tu Cumpleaños</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* ===== Variables y configuración de color ===== */
    :root {
      --primary-color: #5D5CDE;
      --accent-color: #00c2ff;
      --text-color: #ffffff;
      --bg-color-dark-1: #050018;
      --bg-color-dark-2: #0c0932;
      --bg-color-dark-3: #140e40;
      --bg-color-light-1: #f0f4ff;
      --bg-color-light-2: #e0e8ff;
      --bg-color-light-3: #d6e0ff;
      --card-bg-dark: rgba(255, 255, 255, 0.05);
      --card-bg-light: rgba(0, 0, 0, 0.04);
      --shadow-color-dark: rgba(0, 255, 255, 0.1);
      --shadow-color-light: rgba(93, 92, 222, 0.15);
      --text-shadow-dark: 2px 2px 8px #00f0ff;
      --text-shadow-light: 1px 1px 4px rgba(93, 92, 222, 0.5);
    }

    /* ===== Estilo general del fondo y texto ===== */
    * {
      box-sizing: border-box;
    }
    
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to top right, var(--bg-color-dark-1), var(--bg-color-dark-2), var(--bg-color-dark-3));
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px 16px;
      position: relative;
      z-index: 1;
      transition: all 0.3s ease;
    }
    
    /* Modo oscuro/claro basado en preferencias del sistema */
    body.dark-mode {
      background: linear-gradient(to top right, var(--bg-color-dark-1), var(--bg-color-dark-2), var(--bg-color-dark-3));
      color: var(--text-color);
    }
    
    body.light-mode {
      background: linear-gradient(to top right, var(--bg-color-light-1), var(--bg-color-light-2), var(--bg-color-light-3));
      color: #252525;
      --text-shadow-dark: var(--text-shadow-light);
      --shadow-color-dark: var(--shadow-color-light);
      --card-bg-dark: var(--card-bg-light);
    }
    
    @media (prefers-color-scheme: dark) {
      body:not(.light-mode) {
        background: linear-gradient(to top right, var(--bg-color-dark-1), var(--bg-color-dark-2), var(--bg-color-dark-3));
        color: var(--text-color);
      }
    }
    
    @media (prefers-color-scheme: light) {
      body:not(.dark-mode) {
        background: linear-gradient(to top right, var(--bg-color-light-1), var(--bg-color-light-2), var(--bg-color-light-3));
        color: #252525;
        --text-shadow-dark: var(--text-shadow-light);
        --shadow-color-dark: var(--shadow-color-light);
        --card-bg-dark: var(--card-bg-light);
      }
    }
    
    /* Fondo de partículas detrás del contenido */
    #particles-js {
      position: fixed;
      top: 0;
      left: 0;
      z-index: -1;
      width: 100%;
      height: 100%;
    }
    
    /* ===== Título principal ===== */
    h2 {
      font-size: clamp(1.8rem, 5vw, 2.2rem);
      margin-bottom: 25px;
      text-align: center;
      text-shadow: var(--text-shadow-dark);
      opacity: 0; /* Inicialmente invisible para animación GSAP */
      line-height: 1.3;
    }
    
    /* ===== Contenedor de la sección ===== */
    section {
      background-color: var(--card-bg-dark);
      padding: clamp(20px, 5vw, 35px);
      border-radius: 20px;
      max-width: 700px;
      width: 100%;
      margin-bottom: 30px;
      box-shadow: 0 0 30px var(--shadow-color-dark);
      backdrop-filter: blur(10px);
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      opacity: 0; /* Inicialmente invisible para animación GSAP */
      position: relative;
      z-index: 5;
    }
    
    /* ===== Estilo del formulario ===== */
    form {
      margin-bottom: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      padding: 20px;
      border-radius: 15px;
      width: 100%;
      max-width: 400px;
      overflow: hidden;
      text-align: center;
    }
    
    label {
      font-size: 1.1em;
      text-shadow: 1px 1px 4px #fff;
      font-weight: 500;
    }
    
    input[type="date"],
    button {
      padding: 16px;
      margin-top: 15px;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      margin-bottom: 10px;
      width: 100%;
      max-width: 320px;
      transition: all 0.3s ease;
    }
    
    input[type="date"] {
      background-color: rgba(255, 255, 255, 0.9);
      color: #000;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      cursor: pointer;
    }
    
    .light-mode input[type="date"],
    body:not(.dark-mode):not(.light-mode) input[type="date"] {
      box-shadow: 0 0 10px rgba(93, 92, 222, 0.3);
    }
    
    button {
      background-color: var(--primary-color);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 10px rgba(93, 92, 222, 0.5);
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    
    button:hover {
      background-color: #4a49b8;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(93, 92, 222, 0.7);
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    /* ===== Imagen de la NASA ===== */
    .image-container {
      width: 100%;
      overflow: hidden;
      border-radius: 12px;
      margin: 20px 0;
      position: relative;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      aspect-ratio: 16/9;
      background-color: rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      cursor: pointer; /* Indicar que es clickeable */
      transition: transform 0.3s ease;
    }
    
    img:hover {
      transform: scale(1.02);
    }
    
    /* ===== Resultado oculto inicialmente ===== */
    .hidden {
      display: none;
    }
    
    h3 {
      text-shadow: var(--text-shadow-dark);
      font-size: clamp(1.3rem, 4vw, 1.6rem);
      margin-top: 10px;
      margin-bottom: 15px;
    }
    
    p {
      text-shadow: 1px 1px 3px rgba(150, 150, 150, 0.5);
      line-height: 1.7;
      font-size: clamp(1rem, 2.5vw, 1.1rem);
      text-align: left;
      overflow-wrap: break-word;
    }
    
    .light-mode p,
    body:not(.dark-mode):not(.light-mode) p {
      text-shadow: none;
    }
    
    #apod-result.show {
      opacity: 1;
      animation: fadeInUP 0.6s ease-in-out;
    }
    
    @keyframes fadeInUP {
      0% {
        opacity: 0;
        transform: translateY(20px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Loader Container */
    #loader {
      position: fixed;
      inset: 0;
      background: var(--bg-color-dark-1);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999; /* Encima de todo */
      transition: opacity 0.8s ease, visibility 0.8s ease;
    }
    
    /* Ocultar loader */
    #loader.hidden {
      opacity: 0;
      visibility: hidden;
    }
    
    /* Loader Solar System - Reducido y optimizado */
    .solar {
      position: relative;
      width: 40px;
      height: 40px;
      background: orange;
      border-radius: 50%;
      animation: glow 1.5s linear infinite;
      box-shadow: 0 0 20px rgba(255, 165, 0, 0.7);
    }
    
    .solar i {
      border-radius: 250px;
      display: block;
      position: absolute;
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-sizing: border-box;
      transform-origin: 50% 50%;
    }
    
    .solar i:before {
      content: "";
      border-radius: 25px;
      background: black;
      display: block;
      position: absolute;
      top: -5px;
      right: 45%;
    }
    
    .solar i.earth {
      width: 100px;
      height: 100px;
      margin-left: -50px;
      left: 50%;
      top: 50%;
      margin-top: -50px;
      animation: orbit 1.5s linear infinite;
    }
    
    .solar i.earth:before {
      background: #63bee2;
      height: 10px;
      width: 10px;
    }
    
    .solar i.mars {
      width: 140px;
      height: 140px;
      margin-left: -70px;
      left: 50%;
      top: 50%;
      margin-top: -70px;
      animation: orbit 2s linear infinite;
    }
    
    .solar i.mars:before {
      background: red;
      height: 8px;
      width: 8px;
    }
    
    .solar i.jupiter {
      width: 180px;
      height: 180px;
      margin-left: -90px;
      left: 50%;
      top: 50%;
      margin-top: -90px;
      animation: orbit 2.5s linear infinite;
    }
    
    .solar i.jupiter:before {
      background: #cf9b2b;
      top: -10px;
      height: 15px;
      width: 15px;
    }
    
    @keyframes orbit {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(-360deg);
      }
    }
    
    @keyframes glow {
      0% {
        box-shadow: 0 0 5px orange;
      }
      50% {
        background: #ffeb00;
        box-shadow: 0 0 20px orange;
      }
      100% {
        box-shadow: 0 0 5px orange;
      }
    }
    
    /* Estilo para el indicador de carga de traducción */
    #translation-status {
      margin-top: 15px;
      font-style: italic;
      color: var(--accent-color);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-size: 0.9rem;
      height: 24px;
    }
    
    /* Selector de idioma */
    .controls-container {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 100;
      display: flex;
      gap: 10px;
      opacity: 0; /* Inicialmente invisible para animación GSAP */
    }
    
    .language-selector select {
      padding: 8px 12px;
      border-radius: 8px;
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      cursor: pointer;
      font-size: 1rem;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FFFFFF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
      background-repeat: no-repeat;
      background-position: right 8px top 50%;
      background-size: 10px auto;
      padding-right: 25px;
    }
    
    .light-mode .language-selector select,
    body:not(.dark-mode):not(.light-mode) .language-selector select {
      background-color: rgba(0, 0, 0, 0.1);
      color: #252525;
      border: 1px solid rgba(0, 0, 0, 0.2);
      background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23252525%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
    }
    
    .language-selector select:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(93, 92, 222, 0.5);
    }
    
    /* Toggle de modo claro/oscuro */
    .theme-toggle {
      background: none;
      border: none;
      cursor: pointer;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(255, 255, 255, 0.1);
      transition: background-color 0.3s ease;
    }
    
    .theme-toggle:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }
    
    .theme-toggle svg {
      width: 20px;
      height: 20px;
      fill: white;
      transition: transform 0.3s ease;
    }
    
    .light-mode .theme-toggle svg,
    body:not(.dark-mode):not(.light-mode) .theme-toggle svg {
      fill: #252525;
    }
    
    .theme-toggle:hover svg {
      transform: rotate(30deg);
    }
    
    /* Estilos para el lightbox */
    .lightbox {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      backdrop-filter: blur(5px);
    }
    
    .lightbox.active {
      opacity: 1;
      visibility: visible;
    }
    
    .lightbox-content {
      max-width: 95%;
      max-height: 95%;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .lightbox-image {
      max-width: 100%;
      max-height: 90vh;
      border-radius: 5px;
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
      object-fit: contain;
    }
    
    .lightbox-close {
      position: absolute;
      top: -40px;
      right: 0;
      color: white;
      font-size: 30px;
      cursor: pointer;
      background: none;
      border: none;
      outline: none;
      transition: transform 0.3s ease;
    }
    
    .lightbox-close:hover {
      transform: rotate(90deg);
    }
    
    /* Animación de traducción */
    .translation-animation {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--accent-color);
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    
    /* Estilos para las letras flotantes de traducción */
    .floating-letters-container {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 5;
    }
    
    .floating-letter {
      position: absolute;
      font-size: 24px;
      color: var(--accent-color);
      opacity: 0.7;
      user-select: none;
      text-shadow: 0 0 5px rgba(0, 194, 255, 0.5);
    }
    
    /* Estilos responsivos */
    @media (max-width: 768px) {
      section {
        padding: 20px 16px;
      }
      
      h2 {
        margin-top: 40px;
      }
      
      .controls-container {
        top: 10px;
        right: 10px;
      }
      
      .lightbox-content {
        max-width: 98%;
      }
      
      input[type="date"],
      button {
        padding: 14px;
        font-size: 16px;
      }
    }
    
    /* Fallback si JS está deshabilitado */
    .no-js {
      padding: 30px;
      text-align: center;
      background-color: rgba(255, 255, 255, 0.9);
      color: black;
      border-radius: 10px;
      margin: 20px;
    }
  </style>
</head>
<body>
  <!-- Loader Solar System -->
  <div id="loader">
    <div class="solar">
      <i class="earth"></i>
      <i class="mars"></i>
      <i class="jupiter"></i>
    </div>
  </div>

  <!-- Selector de idioma y controles -->
  <div class="controls-container">
    <div class="language-selector">
      <select id="language-select">
        <option value="es">Español</option>
        <option value="en">English</option>
        <option value="fr">Français</option>
        <option value="de">Deutsch</option>
        <option value="it">Italiano</option>
        <option value="pt">Português</option>
      </select>
    </div>
    <button class="theme-toggle" id="theme-toggle" aria-label="Cambiar tema claro/oscuro">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="theme-icon">
        <path d="M12 22c5.52 0 10-4.48 10-10S17.52 2 12 2 2 6.48 2 12s4.48 10 10 10zm0-18c4.42 0 8 3.58 8 8s-3.58 8-8 8-8-3.58-8-8 3.58-8 8-8z"/>
        <path d="M12 18V6c3.31 0 6 2.69 6 6s-2.69 6-6 6z"/>
      </svg>
    </button>
  </div>

  <div id="particles-js"></div> <!-- FONDO DE PARTÍCULAS -->
  
  <!-- Contenedor para letras flotantes de traducción -->
  <div class="floating-letters-container" id="floating-letters"></div>
  
  <!-- ===== Sección del formulario y resultados ===== -->
  <section id="nasa-apod">
    <h2 id="main-title">Dato curioso del universo el día en que naciste</h2>

    <!-- Formulario simple con fecha de nacimiento -->
    <form id="apod-form">
      <label for="birthdate" id="birthdate-label">Selecciona tu fecha de nacimiento:</label>
      <input type="date" id="birthdate" name="birthdate" required />
      <button type="submit" id="submit-button">Descubrir Evento</button>
    </form>

    <!-- Resultados de la API -->
    <div id="apod-result" class="hidden">
      <h3 id="apod-title"></h3>
      <div class="image-container">
        <img id="apod-image" alt="Imagen del evento cósmico" />
      </div>
      <p id="apod-description"></p>
      <div id="translation-status"></div>
    </div>
  </section>
  
  <!-- Lightbox para la imagen -->
  <div class="lightbox" id="image-lightbox">
    <div class="lightbox-content">
      <button class="lightbox-close" id="lightbox-close">&times;</button>
      <img class="lightbox-image" id="lightbox-image" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1 1'%3E%3C/svg%3E" alt="Imagen ampliada" />
    </div>
  </div>

  <!-- Cargar GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>
  
  <!-- Cargar bibliotecas -->
  <script src="https://cdn.jsdelivr.net/npm/i18next@21.6.10/i18next.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

  <!-- ===== Script con lógica para obtener datos de la API ===== -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("apod-form");
      const birthdateInput = document.getElementById("birthdate");
      const resultSection = document.getElementById("apod-result");
      const title = document.getElementById("apod-title");
      const image = document.getElementById("apod-image");
      const description = document.getElementById("apod-description");
      const translationStatus = document.getElementById("translation-status");
      const languageSelect = document.getElementById("language-select");
      const mainTitle = document.getElementById("main-title");
      const birthdateLabel = document.getElementById("birthdate-label");
      const submitButton = document.getElementById("submit-button");
      const nasaSection = document.getElementById("nasa-apod");
      const controlsContainer = document.querySelector(".controls-container");
      const lightbox = document.getElementById("image-lightbox");
      const lightboxImage = document.getElementById("lightbox-image");
      const lightboxClose = document.getElementById("lightbox-close");
      const floatingLettersContainer = document.getElementById("floating-letters");
      const themeToggle = document.getElementById("theme-toggle");
      const loader = document.getElementById("loader");
      
      // Inicializar sistema de tema oscuro/claro según preferencia del usuario
      function initThemePreference() {
        // Comprobar preferencia guardada
        const savedTheme = localStorage.getItem('theme');
        
        if (savedTheme === 'light') {
          document.body.classList.add('light-mode');
          document.body.classList.remove('dark-mode');
          updateThemeIcon(true);
        } else if (savedTheme === 'dark') {
          document.body.classList.add('dark-mode');
          document.body.classList.remove('light-mode');
          updateThemeIcon(false);
        } else {
          // Usar preferencia del sistema
          if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            updateThemeIcon(false);
          } else {
            updateThemeIcon(true);
          }
        }
        
        // Escuchar cambios en la preferencia del sistema
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
          if (!localStorage.getItem('theme')) {
            updateThemeIcon(!event.matches);
          }
        });
      }
      
      // Actualizar el icono del tema
      function updateThemeIcon(isLight) {
        const themeIcon = document.querySelector('.theme-icon');
        if (isLight) {
          themeIcon.innerHTML = '<path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z" />';
        } else {
          themeIcon.innerHTML = '<path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z" />';
        }
      }
      
      // Evento para cambiar el tema
      themeToggle.addEventListener('click', () => {
        if (document.body.classList.contains('light-mode')) {
          document.body.classList.remove('light-mode');
          document.body.classList.add('dark-mode');
          localStorage.setItem('theme', 'dark');
          updateThemeIcon(false);
          
          // Reiniciar partículas para cambiar colores
          initParticles();
        } else {
          document.body.classList.remove('dark-mode');
          document.body.classList.add('light-mode');
          localStorage.setItem('theme', 'light');
          updateThemeIcon(true);
          
          // Reiniciar partículas para cambiar colores
          initParticles();
        }
      });
      
      // Inicializar partículas según el tipo de dispositivo
      function initParticles() {
        // Configuración de partículas para dispositivos de escritorio
        const desktopConfig = {
          "particles": {
            "number": { "value": 80, "density": { "enable": true, "value_area": 800 } },
            "color": { "value": "#ffffff" },
            "shape": { "type": "circle" },
            "opacity": { "value": 0.5 },
            "size": { "value": 3, "random": true },
            "line_linked": { "enable": true, "distance": 150, "color": "#ffffff", "opacity": 0.4, "width": 1 },
            "move": { "enable": true, "speed": 3, "direction": "none", "out_mode": "out" }
          },
          "interactivity": {
            "events": {
              "onhover": { "enable": true, "mode": "repulse" },
              "onclick": { "enable": true, "mode": "push" }
            },
            "modes": { "repulse": { "distance": 100, "duration": 0.4 } }
          }
        };
        
        // Configuración de partículas para dispositivos móviles (menos partículas para mejor rendimiento)
        const mobileConfig = {
          "particles": {
            "number": { "value": 30, "density": { "enable": true, "value_area": 800 } },
            "color": { "value": "#ffffff" },
            "shape": { "type": "circle" },
            "opacity": { "value": 0.5 },
            "size": { "value": 2, "random": true },
            "line_linked": { "enable": true, "distance": 150, "color": "#ffffff", "opacity": 0.4, "width": 1 },
            "move": { "enable": true, "speed": 3, "direction": "none", "out_mode": "out" }
          },
          "interactivity": {
            "events": {
              "onhover": { "enable": true, "mode": "repulse" },
              "onclick": { "enable": true, "mode": "push" }
            },
            "modes": {
              "repulse": { "distance": 100 },
              "push": { "particles_nb": 2 }
            }
          },
          "retina_detect": true
        };
        
        // Seleccionar configuración según tamaño de pantalla
        let particlesConfig = window.innerWidth <= 768 ? mobileConfig : desktopConfig;
        
        // Ajustar colores según el tema
        if (document.body.classList.contains('light-mode')) {
          particlesConfig.particles.color.value = "#555555";
          particlesConfig.particles.line_linked.color = "#555555";
        } else {
          particlesConfig.particles.color.value = "#ffffff";
          particlesConfig.particles.line_linked.color = "#ffffff";
        }
        
        // Iniciar partículas
        particlesJS("particles-js", particlesConfig);
      }
      
      // Inicializar GSAP
      gsap.registerPlugin(TextPlugin);
      
      // Configurar fecha máxima (hoy) en el selector de fecha
      const today = new Date();
      const todayFormatted = today.toISOString().split('T')[0];
      birthdateInput.setAttribute('max', todayFormatted);
      
      // Establecer fecha mínima (cuando comenzó APOD)
      birthdateInput.setAttribute('min', '1995-06-16');
      
      // Animación inicial con GSAP
      function initAnimations() {
        // Timeline para la animación de entrada
        const tl = gsap.timeline();
        
        tl.to(nasaSection, {
          opacity: 1,
          duration: 1,
          ease: "power2.out"
        })
        .to(mainTitle, {
          opacity: 1,
          y: 0,
          duration: 0.8,
          ease: "back.out(1.7)"
        }, "-=0.5")
        .to(controlsContainer, {
          opacity: 1,
          duration: 0.5,
          ease: "power1.out"
        }, "-=0.3");
        
        // Animación para el formulario
        gsap.from("#apod-form", {
          y: 30,
          opacity: 0,
          duration: 0.8,
          delay: 0.5,
          ease: "power2.out"
        });
      }
      
      // Función para crear letras flotantes durante la traducción
      function createFloatingLetters() {
        // Limpiar letras existentes
        floatingLettersContainer.innerHTML = '';
        
        // Letras que aparecerán flotando
        const letters = ['A', 'B', 'C', '1', '2', '3', '@', '#', '$', '%', '&', '*', '+', '=', '<', '>', '?'];
        
        // Crear 15 letras flotantes (reducido para mejor rendimiento)
        for (let i = 0; i < 15; i++) {
          const letter = document.createElement('div');
          letter.className = 'floating-letter';
          letter.textContent = letters[Math.floor(Math.random() * letters.length)];
          
          // Posición inicial aleatoria
          const x = Math.random() * window.innerWidth;
          const y = Math.random() * window.innerHeight;
          
          letter.style.left = `${x}px`;
          letter.style.top = `${y}px`;
          
          floatingLettersContainer.appendChild(letter);
          
          // Animación con GSAP
          gsap.to(letter, {
            x: Math.random() * 200 - 100,
            y: Math.random() * -300 - 50,
            opacity: 0,
            duration: 2 + Math.random() * 3,
            ease: "power1.out",
            onComplete: () => {
              if (floatingLettersContainer.contains(letter)) {
                floatingLettersContainer.removeChild(letter);
              }
            }
          });
        }
      }
      
      // Función para iniciar la animación de traducción
      function startTranslationAnimation() {
        // Crear el elemento de animación de carga
        const animationElement = document.createElement('div');
        animationElement.className = 'translation-animation';
        translationStatus.appendChild(animationElement);
        
        // Iniciar la creación de letras flotantes
        const lettersInterval = setInterval(createFloatingLetters, 300);
        
        return {
          stop: () => {
            // Detener la animación
            if (translationStatus.contains(animationElement)) {
              translationStatus.removeChild(animationElement);
            }
            clearInterval(lettersInterval);
            
            // Animar la desaparición de las letras restantes
            const remainingLetters = document.querySelectorAll('.floating-letter');
            remainingLetters.forEach(letter => {
              gsap.to(letter, {
                opacity: 0,
                duration: 0.5,
                onComplete: () => {
                  if (floatingLettersContainer.contains(letter)) {
                    floatingLettersContainer.removeChild(letter);
                  }
                }
              });
            });
          }
        };
      }

      // Diccionario de traducciones para la interfaz
      const uiTranslations = {
        es: {
          mainTitle: "Dato curioso del universo el día en que naciste",
          birthdateLabel: "Selecciona tu fecha de nacimiento:",
          submitButton: "Descubrir Evento",
          loadingStatus: "Obteniendo datos...",
          translatingStatus: "Traduciendo...",
          translationComplete: "Traducción completada",
          translationError: "Error en la traducción",
          noDataTitle: "No se encontró información para esa fecha.",
          noDataDesc: "Por favor intenta con otra fecha. El rango de fechas disponible comienza desde 1995-06-16 hasta hoy."
        },
        en: {
          mainTitle: "Interesting fact about the universe on your birthday",
          birthdateLabel: "Select your birth date:",
          submitButton: "Discover Event",
          loadingStatus: "Getting data...",
          translatingStatus: "Translating...",
          translationComplete: "Translation completed",
          translationError: "Translation error",
          noDataTitle: "No information found for that date.",
          noDataDesc: "Please try another date. The available date range starts from 1995-06-16 until today."
        },
        fr: {
          mainTitle: "Fait intéressant sur l'univers le jour de votre naissance",
          birthdateLabel: "Sélectionnez votre date de naissance:",
          submitButton: "Découvrir l'événement",
          loadingStatus: "Obtention des données...",
          translatingStatus: "Traduction en cours...",
          translationComplete: "Traduction terminée",
          translationError: "Erreur de traduction",
          noDataTitle: "Aucune information trouvée pour cette date.",
          noDataDesc: "Veuillez essayer une autre date. La plage de dates disponible commence à partir du 16-06-1995 jusqu'à aujourd'hui."
        },
        de: {
          mainTitle: "Interessante Fakten über das Universum an deinem Geburtstag",
          birthdateLabel: "Wählen Sie Ihr Geburtsdatum:",
          submitButton: "Ereignis entdecken",
          loadingStatus: "Daten werden abgerufen...",
          translatingStatus: "Übersetzung läuft...",
          translationComplete: "Übersetzung abgeschlossen",
          translationError: "Übersetzungsfehler",
          noDataTitle: "Keine Informationen für dieses Datum gefunden.",
          noDataDesc: "Bitte versuchen Sie es mit einem anderen Datum. Der verfügbare Datumsbereich beginnt ab dem 16.06.1995 bis heute."
        },
        it: {
          mainTitle: "Fatto interessante sull'universo nel giorno della tua nascita",
          birthdateLabel: "Seleziona la tua data di nascita:",
          submitButton: "Scopri l'evento",
          loadingStatus: "Ottenimento dei dati...",
          translatingStatus: "Traduzione in corso...",
          translationComplete: "Traduzione completata",
          translationError: "Errore di traduzione",
          noDataTitle: "Nessuna informazione trovata per quella data.",
          noDataDesc: "Si prega di provare un'altra data. L'intervallo di date disponibile inizia dal 16-06-1995 fino ad oggi."
        },
        pt: {
          mainTitle: "Fato interessante sobre o universo no dia do seu nascimento",
          birthdateLabel: "Selecione sua data de nascimento:",
          submitButton: "Descobrir Evento",
          loadingStatus: "Obtendo dados...",
          translatingStatus: "Traduzindo...",
          translationComplete: "Tradução concluída",
          translationError: "Erro na tradução",
          noDataTitle: "Nenhuma informação encontrada para essa data.",
          noDataDesc: "Por favor, tente outra data. O intervalo de datas disponível começa de 16-06-1995 até hoje."
        }
      };

      // Diccionario de términos astronómicos específicos para cada idioma
      const astronomyTerms = {
        es: {
          "galaxy": "galaxia",
          "galaxies": "galaxias",
          "star": "estrella",
          "stars": "estrellas",
          "planet": "planeta",
          "planets": "planetas",
          "moon": "luna",
          "moons": "lunas",
          "sun": "sol",
          "solar system": "sistema solar",
          "nebula": "nebulosa",
          "nebulae": "nebulosas",
          "comet": "cometa",
          "comets": "cometas",
          "asteroid": "asteroide",
          "asteroids": "asteroides",
          "black hole": "agujero negro",
          "black holes": "agujeros negros",
          "supernova": "supernova",
          "supernovae": "supernovas",
          "light year": "año luz",
          "light years": "años luz",
          "milky way": "vía láctea",
          "earth": "tierra",
          "mars": "marte",
          "jupiter": "júpiter",
          "saturn": "saturno",
          "uranus": "urano",
          "neptune": "neptuno",
          "mercury": "mercurio",
          "venus": "venus",
          "pluto": "plutón",
          "telescope": "telescopio",
          "telescopes": "telescopios",
          "observatory": "observatorio",
          "observatories": "observatorios",
          "constellation": "constelación",
          "constellations": "constelaciones",
          "universe": "universo",
          "cosmic": "cósmico",
          "astronomy": "astronomía",
          "astronomer": "astrónomo",
          "astronomers": "astrónomos",
          "space": "espacio",
          "spacecraft": "nave espacial",
          "spacecrafts": "naves espaciales",
          "astronaut": "astronauta",
          "astronauts": "astronautas",
          "orbit": "órbita",
          "orbits": "órbitas",
          "satellite": "satélite",
          "satellites": "satélites",
          "gravity": "gravedad",
          "radiation": "radiación",
          "eclipse": "eclipse",
          "eclipses": "eclipses",
          "meteor": "meteoro",
          "meteors": "meteoros",
          "meteorite": "meteorito",
          "meteorites": "meteoritos"
        },
        fr: {
          "galaxy": "galaxie",
          "galaxies": "galaxies",
          "star": "étoile",
          "stars": "étoiles",
          "planet": "planète",
          "planets": "planètes",
          "moon": "lune",
          "moons": "lunes",
          "sun": "soleil",
          "solar system": "système solaire",
          "nebula": "nébuleuse",
          "nebulae": "nébuleuses",
          "comet": "comète",
          "comets": "comètes",
          "asteroid": "astéroïde",
          "asteroids": "astéroïdes",
          "black hole": "trou noir",
          "black holes": "trous noirs",
          "supernova": "supernova",
          "supernovae": "supernovas",
          "light year": "année-lumière",
          "light years": "années-lumière",
          "milky way": "voie lactée",
          "earth": "terre",
          "mars": "mars",
          "jupiter": "jupiter",
          "saturn": "saturne",
          "uranus": "uranus",
          "neptune": "neptune",
          "mercury": "mercure",
          "venus": "vénus",
          "pluto": "pluton",
          "telescope": "télescope",
          "telescopes": "télescopes",
          "observatory": "observatoire",
          "observatories": "observatoires",
          "constellation": "constellation",
          "constellations": "constellations",
          "universe": "univers",
          "cosmic": "cosmique",
          "astronomy": "astronomie",
          "astronome": "astronome",
          "astronomers": "astronomes",
          "space": "espace",
          "spacecraft": "vaisseau spatial",
          "spacecrafts": "vaisseaux spatiaux",
          "astronaut": "astronaute",
          "astronauts": "astronautes",
          "orbit": "orbite",
          "orbits": "orbites",
          "satellite": "satellite",
          "satellites": "satellites",
          "gravity": "gravité",
          "radiation": "radiation",
          "eclipse": "éclipse",
          "eclipses": "éclipses",
          "meteor": "météore",
          "meteors": "météores",
          "meteorite": "météorite",
          "meteorites": "météorites"
        },
        de: {
          "galaxy": "Galaxie",
          "galaxies": "Galaxien",
          "star": "Stern",
          "stars": "Sterne",
          "planet": "Planet",
          "planets": "Planeten",
          "moon": "Mond",
          "moons": "Monde",
          "sun": "Sonne",
          "solar system": "Sonnensystem",
          "nebula": "Nebel",
          "nebulae": "Nebel",
          "comet": "Komet",
          "comets": "Kometen",
          "asteroid": "Asteroid",
          "asteroids": "Asteroiden",
          "black hole": "Schwarzes Loch",
          "black holes": "Schwarze Löcher",
          "supernova": "Supernova",
          "supernovae": "Supernovae",
          "light year": "Lichtjahr",
          "light years": "Lichtjahre",
          "milky way": "Milchstraße",
          "earth": "Erde",
          "mars": "Mars",
          "jupiter": "Jupiter",
          "saturn": "Saturn",
          "uranus": "Uranus",
          "neptune": "Neptun",
          "mercury": "Merkur",
          "venus": "Venus",
          "pluto": "Pluto",
          "telescope": "Teleskop",
          "telescopes": "Teleskope",
          "observatory": "Observatorium",
          "observatories": "Observatorien",
          "constellation": "Sternbild",
          "constellations": "Sternbilder",
          "universe": "Universum",
          "cosmic": "kosmisch",
          "astronomy": "Astronomie",
          "astronomer": "Astronom",
          "astronomers": "Astronomen",
          "space": "Weltraum",
          "spacecraft": "Raumschiff",
          "spacecrafts": "Raumschiffe",
          "astronaut": "Astronaut",
          "astronauts": "Astronauten",
          "orbit": "Umlaufbahn",
          "orbits": "Umlaufbahnen",
          "satellite": "Satellit",
          "satellites": "Satelliten",
          "gravity": "Schwerkraft",
          "radiation": "Strahlung",
          "eclipse": "Finsternis",
          "eclipses": "Finsternisse",
          "meteor": "Meteor",
          "meteors": "Meteore",
          "meteorite": "Meteorit",
          "meteorites": "Meteoriten"
        },
        it: {
          "galaxy": "galassia",
          "galaxies": "galassie",
          "star": "stella",
          "stars": "stelle",
          "planet": "pianeta",
          "planets": "pianeti",
          "moon": "luna",
          "moons": "lune",
          "sun": "sole",
          "solar system": "sistema solare",
          "nebula": "nebulosa",
          "nebulae": "nebulose",
          "comet": "cometa",
          "comets": "comete",
          "asteroid": "asteroide",
          "asteroids": "asteroidi",
          "black hole": "buco nero",
          "black holes": "buchi neri",
          "supernova": "supernova",
          "supernovae": "supernovae",
          "light year": "anno luce",
          "light years": "anni luce",
          "milky way": "via lattea",
          "earth": "terra",
          "mars": "marte",
          "jupiter": "giove",
          "saturn": "saturno",
          "uranus": "urano",
          "neptune": "nettuno",
          "mercury": "mercurio",
          "venus": "venere",
          "pluto": "plutone",
          "telescope": "telescopio",
          "telescopes": "telescopi",
          "observatory": "osservatorio",
          "observatories": "osservatori",
          "constellation": "costellazione",
          "constellations": "costellazioni",
          "universe": "universo",
          "cosmic": "cosmico",
          "astronomy": "astronomia",
          "astronomer": "astronomo",
          "astronomers": "astronomi",
          "space": "spazio",
          "spacecraft": "navicella spaziale",
          "spacecrafts": "navicelle spaziali",
          "astronaut": "astronauta",
          "astronauts": "astronauti",
          "orbit": "orbita",
          "orbits": "orbite",
          "satellite": "satellite",
          "satellites": "satelliti",
          "gravity": "gravità",
          "radiation": "radiazione",
          "eclipse": "eclissi",
          "eclipses": "eclissi",
          "meteor": "meteora",
          "meteors": "meteore",
          "meteorite": "meteorite",
          "meteorites": "meteoriti"
        },
        pt: {
          "galaxy": "galáxia",
          "galaxies": "galáxias",
          "star": "estrela",
          "stars": "estrelas",
          "planet": "planeta",
          "planets": "planetas",
          "moon": "lua",
          "moons": "luas",
          "sun": "sol",
          "solar system": "sistema solar",
          "nebula": "nebulosa",
          "nebulae": "nebulosas",
          "comet": "cometa",
          "comets": "cometas",
          "asteroid": "asteroide",
          "asteroids": "asteroides",
          "black hole": "buraco negro",
          "black holes": "buracos negros",
          "supernova": "supernova",
          "supernovae": "supernovas",
          "light year": "ano-luz",
          "light years": "anos-luz",
          "milky way": "via láctea",
          "earth": "terra",
          "mars": "marte",
          "jupiter": "júpiter",
          "saturn": "saturno",
          "uranus": "urano",
          "neptune": "netuno",
          "mercury": "mercúrio",
          "venus": "vênus",
          "pluto": "plutão",
          "telescope": "telescópio",
          "telescopes": "telescópios",
          "observatory": "observatório",
          "observatories": "observatórios",
          "constellation": "constelação",
          "constellations": "constelações",
          "universe": "universo",
          "cosmic": "cósmico",
          "astronomy": "astronomia",
          "astronomer": "astrônomo",
          "astronomers": "astrônomos",
          "space": "espaço",
          "spacecraft": "nave espacial",
          "spacecrafts": "naves espaciais",
          "astronaut": "astronauta",
          "astronauts": "astronautas",
          "orbit": "órbita",
          "orbits": "órbitas",
          "satellite": "satélite",
          "satellites": "satélites",
          "gravity": "gravidade",
          "radiation": "radiação",
          "eclipse": "eclipse",
          "eclipses": "eclipses",
          "meteor": "meteoro",
          "meteors": "meteoros",
          "meteorite": "meteorito",
          "meteorites": "meteoritos"
        }
      };

      // Función para actualizar la interfaz según el idioma seleccionado
      function updateUILanguage(lang) {
        mainTitle.textContent = uiTranslations[lang].mainTitle;
        birthdateLabel.textContent = uiTranslations[lang].birthdateLabel;
        submitButton.textContent = uiTranslations[lang].submitButton;
      }

      // Evento para cambiar el idioma
      languageSelect.addEventListener('change', async (e) => {
        const selectedLang = e.target.value;
        updateUILanguage(selectedLang);
        
        // Si ya hay resultados mostrados, volver a traducir
        if (!resultSection.classList.contains("hidden")) {
          const originalTitle = title.dataset.original;
          const originalDescription = description.dataset.original;
          
          if (originalTitle && originalDescription) {
            if (selectedLang === "en") {
              // Si el idioma es inglés, mostrar el texto original con animación
              gsap.to(title, {
                opacity: 0,
                duration: 0.3,
                onComplete: () => {
                  title.textContent = originalTitle;
                  gsap.to(title, {
                    opacity: 1,
                    duration: 0.3
                  });
                }
              });
              
              gsap.to(description, {
                opacity: 0,
                duration: 0.3,
                onComplete: () => {
                  description.textContent = originalDescription;
                  gsap.to(description, {
                    opacity: 1,
                    duration: 0.3
                  });
                }
              });
              
              translationStatus.textContent = "";
            } else {
              // Si es otro idioma, traducir con la API de traducción
              try {
                // Iniciar animación de traducción
                const animation = startTranslationAnimation();
                translationStatus.textContent = uiTranslations[selectedLang].translatingStatus;
                
                const translatedTitle = await translateText(originalTitle, selectedLang);
                const translatedDescription = await translateText(originalDescription, selectedLang);
                
                // Detener animación
                animation.stop();
                
                // Animar cambio de título
                gsap.to(title, {
                  opacity: 0,
                  duration: 0.3,
                  onComplete: () => {
                    title.textContent = translatedTitle;
                    gsap.to(title, {
                      opacity: 1,
                      duration: 0.3
                    });
                  }
                });
                
                // Animar cambio de descripción
                gsap.to(description, {
                  opacity: 0,
                  duration: 0.3,
                  onComplete: () => {
                    description.textContent = translatedDescription;
                    gsap.to(description, {
                      opacity: 1,
                      duration: 0.3
                    });
                  }
                });
                
                translationStatus.textContent = uiTranslations[selectedLang].translationComplete;
                
                // Animar el estado de traducción
                gsap.from(translationStatus, {
                  y: 10,
                  opacity: 0,
                  duration: 0.5
                });
              } catch (error) {
                console.error("Error en la traducción:", error);
                translationStatus.textContent = uiTranslations[selectedLang].translationError;
              }
            }
          }
        }
      });

      // Inicializar la interfaz con el idioma por defecto
      updateUILanguage('es');

      // Función mejorada para traducir texto 
      // (API de Lingva puede sufrir cambios - implementación de respaldo)
      async function translateText(text, targetLang) {
        if (targetLang === 'en') {
          return text;
        }
        
        try {
          // 1. Intentar con Lingva (proxy gratuito para Google Translate)
          try {
            const response = await fetch(`https://lingva.ml/api/v1/en/${targetLang}/${encodeURIComponent(text)}`);
            const data = await response.json();
            
            if (data.translation) {
              return data.translation;
            }
          } catch (err) {
            console.warn("Error con Lingva API, usando método alternativo:", err);
          }
          
          // 2. Alternativa de traducción usando LibreTranslate
          try {
            const response = await fetch("https://libretranslate.de/translate", {
              method: "POST",
              body: JSON.stringify({
                q: text,
                source: "en",
                target: targetLang,
                format: "text"
              }),
              headers: { "Content-Type": "application/json" }
            });
            
            const data = await response.json();
            if (data.translatedText) {
              return data.translatedText;
            }
          } catch (err) {
            console.warn("Error con LibreTranslate, usando traducción simple:", err);
          }
          
          // 3. Como método de respaldo, aplicar traducción simple basada en el diccionario
          // Traducción de términos específicos usando el diccionario
          let translatedText = text;
          const terms = astronomyTerms[targetLang];
          if (terms) {
            Object.keys(terms).forEach(term => {
              // Usar expresión regular para reemplazar palabras completas
              const regex = new RegExp('\\b' + term + '\\b', 'gi');
              translatedText = translatedText.replace(regex, terms[term]);
            });
          }
          
          return translatedText;
        } catch (error) {
          console.error("Todos los métodos de traducción fallaron:", error);
          throw error;
        }
      }
      
      // Configuración del lightbox
      image.addEventListener('click', () => {
        lightboxImage.src = image.src;
        lightbox.classList.add('active');
        
        // Animación de apertura con GSAP
        gsap.fromTo(lightboxImage, 
          { scale: 0.8, opacity: 0 },
          { scale: 1, opacity: 1, duration: 0.5, ease: "back.out(1.7)" }
        );
      });
      
      lightboxClose.addEventListener('click', () => {
        // Animación de cierre con GSAP
        gsap.to(lightboxImage, {
          scale: 0.8,
          opacity: 0,
          duration: 0.3,
          onComplete: () => {
            lightbox.classList.remove('active');
          }
        });
      });
      
      // Cerrar lightbox al hacer clic fuera de la imagen
      lightbox.addEventListener('click', (e) => {
        if (e.target === lightbox) {
          gsap.to(lightboxImage, {
            scale: 0.8,
            opacity: 0,
            duration: 0.3,
            onComplete: () => {
              lightbox.classList.remove('active');
            }
          });
        }
      });

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const date = birthdateInput.value;
        const selectedLang = languageSelect.value;
        
        // Validar la fecha seleccionada
        const selectedDate = new Date(date);
        const minDate = new Date('1995-06-16');
        
        if (selectedDate < minDate) {
          alert(uiTranslations[selectedLang].noDataDesc);
          return;
        }
        
        // Animación de carga con GSAP
        gsap.to(submitButton, {
          scale: 0.95,
          duration: 0.2,
          yoyo: true,
          repeat: 1
        });
        
        translationStatus.textContent = uiTranslations[selectedLang].loadingStatus;
        
        // Si el resultado estaba oculto, mostrarlo con animación
        if (resultSection.classList.contains("hidden")) {
          resultSection.classList.remove("hidden");
          gsap.fromTo(resultSection, 
            { opacity: 0, y: 30 },
            { opacity: 1, y: 0, duration: 0.8, ease: "power2.out" }
          );
        }

        // 🔑 Aquí se define tu API Key personal de la NASA
        const apiKey = "2qSBo4SR5ZcfzH5uRxbCTjizz3nE7bTNT5bc0791";

        try {
          // Simulación de carga - mejor experiencia de usuario
          submitButton.disabled = true;  // Deshabilitar botón mientras carga
          
          // Añadir indicador visual de carga
          submitButton.innerHTML = `<span class="translation-animation" style="width:16px;height:16px;margin-right:8px;"></span>${uiTranslations[selectedLang].loadingStatus}`;
          
          // Llamada a la NASA APOD API
          const response = await fetch(`https://api.nasa.gov/planetary/apod?api_key=${apiKey}&date=${date}`);
          
          // Restaurar estado del botón
          submitButton.disabled = false;
          submitButton.textContent = uiTranslations[selectedLang].submitButton;
          
          if (!response.ok) {
            throw new Error(`Error en la respuesta de la API: ${response.status}`);
          }
          
          const data = await response.json();
          
          // Guardar los datos originales como atributos de datos
          title.dataset.original = data.title;
          description.dataset.original = data.explanation;
          
          // Si el idioma seleccionado es inglés, mostramos los datos originales con animación
          if (selectedLang === 'en') {
            // Animar título
            gsap.to(title, {
              opacity: 0,
              duration: 0.3,
              onComplete: () => {
                title.textContent = data.title;
                gsap.to(title, {
                  opacity: 1,
                  duration: 0.5,
                  ease: "power2.out"
                });
              }
            });
            
            // Animar descripción
            gsap.to(description, {
              opacity: 0,
              duration: 0.3,
              onComplete: () => {
                description.textContent = data.explanation;
                gsap.to(description, {
                  opacity: 1,
                  duration: 0.5,
                  ease: "power2.out"
                });
              }
            });
            
            translationStatus.textContent = "";
          } else {
            // Si es otro idioma, traducir y animar
            try {
              // Iniciar animación de traducción
              const animation = startTranslationAnimation();
              translationStatus.textContent = uiTranslations[selectedLang].translatingStatus;
              
              // Mostrar título y descripción en inglés primero con efecto de typing
              title.textContent = "";
              gsap.to(title, {
                text: {
                  value: data.title,
                  delimiter: ""
                },
                duration: 1,
                ease: "none"
              });
              
              // Traducir
              const translatedTitle = await translateText(data.title, selectedLang);
              const translatedDescription = await translateText(data.explanation, selectedLang);
              
              // Detener animación
              animation.stop();
              
              // Animar cambio de título
              gsap.to(title, {
                opacity: 0,
                duration: 0.3,
                onComplete: () => {
                  title.textContent = translatedTitle;
                  gsap.to(title, {
                    opacity: 1,
                    duration: 0.5
                  });
                }
              });
              
              // Animar cambio de descripción
              description.textContent = translatedDescription;
              gsap.from(description, {
                opacity: 0,
                y: 20,
                duration: 0.8,
                ease: "power2.out"
              });
              
              translationStatus.textContent = uiTranslations[selectedLang].translationComplete;
              
              // Animar el estado de traducción
              gsap.from(translationStatus, {
                y: 10,
                opacity: 0,
                duration: 0.5
              });
            } catch (translationError) {
              console.error("Error en la traducción:", translationError);
              // Si la API falla, mostramos el contenido en inglés
              title.textContent = data.title;
              description.textContent = data.explanation;
              translationStatus.textContent = uiTranslations[selectedLang].translationError;
            }
          }

          // Si el tipo de medio es imagen, la mostramos con animación
          if (data.media_type === "image") {
            // Primero ocultamos la imagen anterior si existe
            gsap.to(image, {
              opacity: 0,
              scale: 0.9,
              duration: 0.3,
              onComplete: () => {
                image.src = data.url;
                image.onload = () => {
                  gsap.to(image, {
                    opacity: 1,
                    scale: 1,
                    duration: 0.8,
                    ease: "back.out(1.7)"
                  });
                };
                
                // Si la imagen no carga en 5 segundos, mostrar mensaje
                const timeoutId = setTimeout(() => {
                  if (!image.complete) {
                    image.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='200'%3E%3Crect width='300' height='200' fill='%23cccccc'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23666666' font-family='Arial' font-size='16'%3EImagen no disponible%3C/text%3E%3C/svg%3E";
                    image.style.display = "block";
                    gsap.to(image, {
                      opacity: 1,
                      scale: 1,
                      duration: 0.5
                    });
                  }
                }, 5000);
                
                image.onload = () => {
                  clearTimeout(timeoutId);
                  gsap.to(image, {
                    opacity: 1,
                    scale: 1,
                    duration: 0.8,
                    ease: "back.out(1.7)"
                  });
                };
              }
            });
          } else {
            gsap.to(image, {
              opacity: 0,
              scale: 0.9,
              duration: 0.3,
              onComplete: () => {
                // Si no es una imagen, mostrar un placeholder indicando que es un video
                image.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='200'%3E%3Crect width='300' height='200' fill='%23000'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23ffffff' font-family='Arial' font-size='16'%3EContenido de video no soportado%3C/text%3E%3Ctext x='50%25' y='65%25' dominant-baseline='middle' text-anchor='middle' fill='%23ffffff' font-family='Arial' font-size='12'%3EVer en NASA APOD%3C/text%3E%3C/svg%3E";
                image.style.cursor = "pointer";
                image.onclick = () => {
                  window.open(`https://apod.nasa.gov/apod/ap${date.replace(/-/g, '').substring(2)}.html`, '_blank');
                };
                gsap.to(image, {
                  opacity: 1,
                  scale: 1,
                  duration: 0.5
                });
              }
            });
          }

        } catch (err) {
          console.error("Error al obtener o procesar los datos:", err);
          
          // Restaurar estado del botón
          submitButton.disabled = false;
          submitButton.textContent = uiTranslations[selectedLang].submitButton;
          
          // Animar mensajes de error
          gsap.to([title, description], {
            opacity: 0,
            duration: 0.3,
            onComplete: () => {
              title.textContent = uiTranslations[selectedLang].noDataTitle;
              description.textContent = uiTranslations[selectedLang].noDataDesc;
              
              gsap.to([title, description], {
                opacity: 1,
                duration: 0.5,
                stagger: 0.2
              });
            }
          });
          
          gsap.to(image, {
            opacity: 0,
            scale: 0.9,
            duration: 0.3,
            onComplete: () => {
              image.style.display = "none";
            }
          });
          
          translationStatus.textContent = "";
        }
      });
      
      // Ocultar el loader cuando la página esté cargada
      window.addEventListener("load", function() {
        setTimeout(() => {
          loader.classList.add("hidden");
          
          // Inicializar animaciones y partículas después de quitar el loader
          setTimeout(() => {
            initAnimations();
            initParticles();
            initThemePreference();
          }, 100);
        }, 800); // Pequeño retraso para la animación
      });
      
      // Inicializar para carga rápida o si la ventana ya estaba cargada
      if (document.readyState === 'complete') {
        loader.classList.add("hidden");
        initAnimations();
        initParticles();
        initThemePreference();
      }
    });
  </script>
</body>
</html>
